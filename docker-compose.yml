services:
  arch-vscode:
    build: .
    container_name: arch-vscode-dev
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - USERNAME=${USERNAME:-developer}
      - WORKSPACE_DIR=/workspace
      - VSCODE_DEFAULT_FOLDER=${VSCODE_DEFAULT_FOLDER:-/workspace}
      - EXTRA_PACKAGES=${EXTRA_PACKAGES:-}
      - AUTO_UPDATE=${AUTO_UPDATE:-false}
      - TZ=${TZ:-UTC}
    volumes:
      - ./:/workspace
      - ./home:/home/${USERNAME:-developer}
    ports:
      - "8080:8080"
    restart: unless-stopped
    stdin_open: true
    tty: true
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/", "||", "exit", "1"]
      interval: 30s
      timeout: 10s
      start_period: 60s
      retries: 3
    networks:
      - arch-vscode-net
